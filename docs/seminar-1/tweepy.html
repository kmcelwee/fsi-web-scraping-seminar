<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Intro to Tweepy - FSI Web Scraping Seminar</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Intro to Tweepy | FSI Web Scraping Seminar</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Intro to Tweepy" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="[WIP] A collection of web scraping resources for the 2021 FSI summer course Humanistic Approaches to Media and Data." /> <meta property="og:description" content="[WIP] A collection of web scraping resources for the 2021 FSI summer course Humanistic Approaches to Media and Data." /> <link rel="canonical" href="/seminar-1/tweepy" /> <meta property="og:url" content="/seminar-1/tweepy" /> <meta property="og:site_name" content="FSI Web Scraping Seminar" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Intro to Tweepy" /> <script type="application/ld+json"> {"description":"[WIP] A collection of web scraping resources for the 2021 FSI summer course Humanistic Approaches to Media and Data.","@type":"WebPage","url":"/seminar-1/tweepy","headline":"Intro to Tweepy","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> FSI Web Scraping Seminar </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/seminar-1" class="nav-list-link">Seminar 1</a><ul class="nav-list "><li class="nav-list-item "><a href="/seminar-1/python" class="nav-list-link">Python programming refresher</a></li><li class="nav-list-item "><a href="/seminar-1/colab" class="nav-list-link">Intro to Colab</a></li><li class="nav-list-item "><a href="/seminar-1/json-and-csv" class="nav-list-link">File formats</a></li><li class="nav-list-item active"><a href="/seminar-1/tweepy" class="nav-list-link active">Intro to Tweepy</a></li><li class="nav-list-item "><a href="/seminar-1/apis" class="nav-list-link">Intro to APIs</a></li><li class="nav-list-item "><a href="/seminar-1/munge-json" class="nav-list-link">Data cleaning</a></li><li class="nav-list-item "><a href="/seminar-1/examples" class="nav-list-link">How to develop a research question</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search FSI Web Scraping Seminar" aria-label="Search FSI Web Scraping Seminar" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/seminar-1">Seminar 1</a></li> <li class="breadcrumb-nav-list-item"><span>Intro to Tweepy</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="introduction-to-tweepy"> <a href="#introduction-to-tweepy" class="anchor-heading" aria-labelledby="introduction-to-tweepy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction to Tweepy </h1> <p>Let‚Äôs log into the Twitter API and execute our first query!</p> <h2 id="twitter-advanced-search"> <a href="#twitter-advanced-search" class="anchor-heading" aria-labelledby="twitter-advanced-search"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Twitter Advanced Search </h2> <p>Before using the Twitter API, consider <a href="https://twitter.com/search-advanced?lang=en">Twitter Advanced Search</a>. You can often get a lot of answers before writing a line of code! Other forms of site-specific syntax can also be useful</p> <h2 id="first-api-login"> <a href="#first-api-login" class="anchor-heading" aria-labelledby="first-api-login"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> First API Login </h2> <p>First, we need your authentication token. Log in to the developer portal. Create a new project under ‚ÄúProjects &amp; Apps‚Äù. Name your project <code class="language-plaintext highlighter-rouge">fsi-seminar</code> and answer that your purpose is to learn the Twitter API. After filling out the questionaire, you‚Äôll be met with the alphanumeric keys generated for you to use the Twitter API. Copy both the ‚ÄúAPI Key‚Äù and the ‚ÄúAPI Secret Key‚Äù into a new Colab notebook.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tweepy</span> <span class="c1"># https://github.com/tweepy/tweepy
</span>
<span class="n">consumer_key</span> <span class="o">=</span> <span class="s">""</span> <span class="c1"># put your information here!
</span><span class="n">consumer_secret</span> <span class="o">=</span> <span class="s">""</span> <span class="c1"># put your information here!
</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="p">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="p">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>

<span class="c1"># get tweet ID
</span><span class="n">tweet</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">get_status</span><span class="p">(</span><span class="mi">1412424266763603968</span><span class="p">)</span>
<span class="n">tweet</span><span class="p">.</span><span class="n">text</span>
</code></pre></div></div> <p>And there you go! You should see the text from a tweet from NASA. What do you notice about how the text is formatted?</p> <h1 id="scrape-a-profile"> <a href="#scrape-a-profile" class="anchor-heading" aria-labelledby="scrape-a-profile"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scrape a profile </h1> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_all_tweets</span><span class="p">(</span><span class="n">screen_name</span><span class="p">):</span>
    <span class="n">alltweets</span> <span class="o">=</span> <span class="p">[]</span>  
    <span class="n">new_tweets</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">user_timeline</span><span class="p">(</span><span class="n">screen_name</span> <span class="o">=</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">alltweets</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_tweets</span><span class="p">)</span>

    <span class="n">oldest</span> <span class="o">=</span> <span class="n">alltweets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nb">id</span> <span class="o">-</span> <span class="mi">1</span>
    
    <span class="c1"># keep grabbing tweets until there are no tweets left to grab
</span>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_tweets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">new_tweets</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">user_timeline</span><span class="p">(</span><span class="n">screen_name</span> <span class="o">=</span> <span class="n">screen_name</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">max_id</span><span class="o">=</span><span class="n">oldest</span><span class="p">)</span>
        <span class="n">alltweets</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_tweets</span><span class="p">)</span>
        <span class="n">oldest</span> <span class="o">=</span> <span class="n">alltweets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nb">id</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"...</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">alltweets</span><span class="p">)</span><span class="si">}</span><span class="s"> tweets downloaded so far"</span><span class="p">)</span>
    
    <span class="c1"># transform the tweepy tweets into a 2D array that will populate the csv 
</span>    <span class="n">outtweets</span> <span class="o">=</span> <span class="p">[[</span><span class="n">tweet</span><span class="p">.</span><span class="n">id_str</span><span class="p">,</span> <span class="n">tweet</span><span class="p">.</span><span class="n">created_at</span><span class="p">,</span> <span class="n">tweet</span><span class="p">.</span><span class="n">text</span><span class="p">]</span> <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">alltweets</span><span class="p">]</span>
    
    <span class="c1"># write the csv  
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'new_</span><span class="si">{</span><span class="n">screen_name</span><span class="si">}</span><span class="s">_tweets.csv'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="p">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">writerow</span><span class="p">([</span><span class="s">"id"</span><span class="p">,</span><span class="s">"created_at"</span><span class="p">,</span><span class="s">"text"</span><span class="p">])</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">outtweets</span><span class="p">)</span>

<span class="n">get_all_tweets</span><span class="p">(</span><span class="s">'SCREEN_NAME'</span><span class="p">)</span>
</code></pre></div></div> <p>What do you notice about how this CSV was created differently than other code we‚Äôve looked at?</p> <details> <summary>Toggle to see some answers:</summary> <ul> <li>Because we're using tweepy, we can get to the text and timestamp information straight from what tweepy calls a Tweet object. You can't do this with JSON, but tweepy already parsed the most important features and making them easily accessible.</li> <li>We're using python's <a href="https://docs.python.org/3/library/csv.html">csv library</a> instead of Pandas to write the CSV. If you're not analyzing the data and just want to make a CSV, using this library can be useful.</li> </ul> </details> <h1 id="get-profile-information"> <a href="#get-profile-information" class="anchor-heading" aria-labelledby="get-profile-information"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Get profile information </h1> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">user</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">get_user</span><span class="p">(</span><span class="s">'SCREEN_NAME'</span><span class="p">)</span>
</code></pre></div></div> <p>ü™ê <strong>Exercise: Get the location of NASA through their Twitter profile.</strong></p> <details><summary><a class="btn btn-purple">View Solution</a></summary> <script src="https://gist.github.com/kmcelwee/d23a027129b0b4f2026afb519a8873c5.js"></script> </details> <h1 id="collecting-tweets-by-hashtag"> <a href="#collecting-tweets-by-hashtag" class="anchor-heading" aria-labelledby="collecting-tweets-by-hashtag"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Collecting tweets by hashtag </h1> <p>Read more about the search parameters <a href="https://docs.tweepy.org/en/v3.5.0/api.html#help-methods">here</a>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tweet_list</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'#pride'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweet_list</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tweet</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div> <p>You can read more about how these search strings can be constructed <a href="https://developer.twitter.com/en/docs/twitter-api/tweets/search/integrate/build-a-query">here</a>. But tweepy isn‚Äôt very reliable with complex searches. By default this command will return ten or so tweets, but by setting the <code class="language-plaintext highlighter-rouge">count</code> parameter, you can gather more.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
